<app-navbar></app-navbar>
<!-- Page Content -->
<div id="page-content">
   

    <div class="container my-5">
        <div class="row">
            <!-- Property Detail Content -->
            <div class="col-md-9 col-sm-9">
                <section id="property-detail">
                    <header class="property-title">
                        <h1>{{property.title}}</h1>
                        <figure>{{property.property_type}}, {{property.property_number}}</figure>
                        <span class="actions">
                            <!--<a href="#" class="fa fa-print"></a>-->
                            <a href="#" class="bookmark" data-bookmark-state="empty"><span class="title-add">Add to bookmark</span><span class="title-added">Added</span></a>
                        </span>
                    </header>
                    <div id="carouselExampleFade" class="carousel slide carousel-fade mb-4" *ngIf="property">
                        <div class="carousel-inner">
                          <div class="carousel-item" *ngFor="let image of property.image; let i = index" [class.active]="i === 0">
                            <img src="http://localhost:8000/images/{{image}}" class="d-block w-100" style="height: 514px">
                          </div>
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleFade" data-bs-slide="prev">
                          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                          <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleFade" data-bs-slide="next">
                          <span class="carousel-control-next-icon" aria-hidden="true"></span>
                          <span class="visually-hidden">Next</span>
                        </button>
                      </div>
                    <div class="row">
                        <div class="col-md-4 col-sm-12">
                            <section id="quick-summary" class="clearfix">
                                <header><h2>Quick Summary</h2></header>
                                <dl>
                                    <dt>Location</dt>
                                        <dd>{{property.city}},{{property.street}}</dd>
                                    <dt>Price</dt>
                                        <dd><span class="tag price">LE {{property.price}}</span></dd>
                                    <dt>Property Type:</dt>
                                        <dd>{{property.property_type}}</dd>
                                    <dt>Status:</dt>
                                        <dd>Sale</dd>
                                    <dt>Area:</dt>
                                        <dd>{{property.area}} m<sup>2</sup></dd>
                                    <dt>Beds:</dt>
                                        <dd>3</dd>
                                    <dt>Baths:</dt>
                                        <dd>2</dd>
                                    <dt>Garages:</dt>
                                        <dd>2</dd>
                                    <dt>Rating:</dt>
                                        <dd><div class="pt-1">
                                            <p-rating [(ngModel)]="overallValue" [readonly]="true" [cancel]="false"></p-rating>
                                        </div></dd>
                                </dl>
                            </section><!-- /#quick-summary -->
                        </div><!-- /.col-md-4 -->
                        <div class="col-md-8 col-sm-12">
                            <section id="description">
                                <header><h2>Property Description</h2></header>
                                <p>
                                    {{property.description}}
                                </p>
                            </section><!-- /#description -->
                            
                           
                            <!-- <section id="property-map">
                                <header><h2>Map</h2></header>
                                <div class="property-detail-map-wrapper">
                                    <div class="property-detail-map" id="property-detail-map"></div>
                                </div>
                            </section> -->
                            <!-- /#property-map -->
                            <section id="property-rating">
                                <header><h2>Rating</h2></header>
                                <div class="clearfix text-center">
                                    <!-- <aside>
                                        <header>Your Rating</header>
                                        <div class="rating rating-user">
                                            <div class="inner">
                                                <p-rating [(ngModel)]="userValue" [cancel]="false"></p-rating>
                                            </div>
                                        </div>
                                    </aside> -->
                                    <figure class="float-none">
                                        <header>Overall Rating</header>
                                        <div class="rating rating-overall" [innerHTML]="finalRatingForProperty | rating"></div>
                                    </figure>
                                </div>
                                
                            </section><!-- /#property-rating -->
                            
                        </div><!-- /.col-md-8 -->
                        <div class="col-md-12 col-sm-12">
                            
                            <!-- <hr class="thick">
                            <section id="similar-properties">
                                <header><h2 class="no-border">Similar Properties</h2></header>
                                <div class="row">
                                    @for (property of similarProperties; track property.id) {
                                        <div class="col-md-4 col-sm-6">
                                            <app-property-card></app-property-card>
                                        </div>
                                    }
                                </div>
                            </section> -->
                            <hr class="thick">
                            <section id="comments">
                                <header><h2 class="no-border">Comments</h2></header>
                                <ul class="comments">
                                    @for (comment of commentData; track comment) {
                                        @if(comment.property_id == id){
                                            <li class="comment w-100">
                                                <figure>
                                                    <div class="image">
                                                        <img alt="" src="assets/img/user.png">
                                                    </div>
                                                </figure>
                                                <div class="comment-wrapper">
                                                    <div class="name">{{comment.name}}</div>
                                                    <span class="date"><span class="fa fa-calendar"></span>{{comment.date}}</span>
                                                    <div class="rating rating-individual" data-score="5"></div>
                                                    <p>{{comment.comment}}</p>
                                                    @if(comment.email ==userLogged[1].email){
                                                        <a class="reply" style="cursor: pointer;" (click)="deleteComment(comment.id)"><span class="fa fa-reply text-danger"></span>delete</a>
                                                    }
                                                    <hr>
                                                </div>
                                            </li>
                                        }
                                    }
                                </ul>
                            </section>
                            <hr class="thick">
                            <section id="comments">
                                <header>
                                    <h2 class="no-border">Reviews</h2>
                                </header>
                                <form role="form" id="form-create-account" method="post" [formGroup]="registerForm">
                                    <div id="agency">
                                        <div class="form-group">
                                            <label for="account-agency" class="text-secondary my-2" style="opacity: 0.6"
                                                formControlName="dropdownValue">Select your agency:</label>
                                            <br />
                                            <select formControlName="rate" class="custom-dropdown" name="account-agency" id="account-agency" class="text-secondary">
                                                <option value="">Select rate:</option>
                                                <option value="1">Not very good</option>
                                                <option value="2">Not good</option>
                                                <option value="3">acceptable</option>
                                                <option value="4">good</option>
                                                <option value="5">very good</option>
                                            </select>
                                            @if(registerForm.controls['rate'].invalid &&
                                            registerForm.controls['rate'].touched ){
                                            @if(registerForm.controls['rate'].errors?.['required']) {
                                            <span class="form-text text-danger"> Required </span>
                                            }}
                                        </div>
                                    </div>
                                
                                    <hr />
                                    <div class="form-group mb-3" [formGroup]="registerForm">
                                        <label for="form-create-account-full-name" style="font-weight: bold; color: rgb(92, 91, 91)">Comment:</label>
                                        <textarea type="text" class="form-control" id="form-create-account-full-name" required
                                            style="background-color: rgb(242, 241, 241); border-radius: 0; height: 300px; resize: none;" class="form-control" id="fullname"
                                            formControlName="comment" ></textarea>
                                        @if(registerForm.controls['comment'].invalid &&
                                        registerForm.controls['comment'].touched ){
                                        @if(registerForm.controls['comment'].errors?.['minlength']) {
                                        <span class="form-text text-danger"> Min length is 3 </span>
                                        }}
                                    </div>
                                    <div class="checkbox">
                                        <button (click)="handlesubmit()" disabled [disabled]="registerForm.invalid" type="submit"
                                            class="btn pull-right btn-default btn-primary" id="bttn">
                                            Add Review
                                        </button>
                                        @if(completedReview){
                                        <div class="text-success" style="font-size: 15px; margin-top: 10px;">
                                            completed send review.
                                        </div>
                                        }
                                    </div>
                                </form>
                            </section>
                        </div><!-- /.col-md-12 -->
                    </div><!-- /.row -->
                </section><!-- /#property-detail -->
            </div><!-- /.col-md-9 -->
            <!-- end Property Detail Content -->

            <!-- sidebar -->
            <div class="col-md-3 col-sm-3">
                <section id="sidebar">
                    @if (!isLoggedIn) {
                        <aside id="edit-search">
                            <header><h3>Make an Offer</h3></header>
                            <div class="text-center"><a routerLink="/signin" class="nav-link">Sign in to make an offer</a></div>
                        </aside>
                    }@else if (isLoggedIn && userRole === "user") {
                        <form>
                            <header><h3>Make an Offer</h3></header>
                            @if (offerSubmittedBefore) {
                                <div class="alert alert-info">You have submitted an offer on this property .. Pending lister approval.</div>
                            }@else {
                                <div>
                                    <button class="btn btn-default" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">Make Offer now</button>
                                </div>
                                <div class="collapse" id="collapseExample">
                                    <div class="card card-body">
                                        <form [formGroup]="offerForm" (ngSubmit)="submitOffer()">
                                            <div class="mb-3">
                                              <label for="offeredPrice" class="form-label">Offered Price</label>
                                              <input type="number" class="form-control" id="offeredPrice" formControlName="offeredPrice">
                                              <div *ngIf="offerForm.controls['offeredPrice'].invalid && offerForm.controls['offeredPrice'].dirty || offerForm.controls['offeredPrice'].touched" class="text-danger small">
                                                <div *ngIf="offerForm.controls['offeredPrice'].errors?.['required']">Offered price is required.</div>
                                                <div *ngIf="offerForm.controls['offeredPrice'].errors?.['min']">Offered price must be greater than 0.</div>
                                              </div>
                                            </div>
                                            
                                            <div class="mb-3">
                                              <label for="message" class="form-label">Message</label>
                                              <textarea class="form-control" id="message" formControlName="message" rows="4"></textarea>
                                              <div *ngIf="offerForm.controls['message'].invalid && offerForm.controls['message'].dirty || offerForm.controls['message'].touched" class="text-danger small">
                                                Message is required.
                                              </div>
                                            </div>
                                          
                                            <button type="submit" class="btn pull-right btn-default btn-primary " [disabled]="offerForm.invalid">Submit Offer</button>
                                        </form>                                      
                                    </div>
                                </div>
                            }
                        </form>   
                    }
                    
                    <aside id="edit-search">
                        <header><h3>Search Properties</h3></header>
                        <form role="form" id="form-sidebar" class="form-search">
                            <div class="form-group">
                                <select name="type" class="w-100">
                                    <option value="">Status</option>
                                    <option value="1">Rent</option>
                                    <option value="2">Sale</option>
                                </select>
                            </div><!-- /.form-group -->
                            <div class="form-group">
                                <select name="country" class="w-100">
                                    <option value="">Country</option>
                                    <option value="1">France</option>
                                    <option value="2">Great Britain</option>
                                    <option value="3">Spain</option>
                                    <option value="4">Russia</option>
                                    <option value="5">United States</option>
                                </select>
                            </div><!-- /.form-group -->
                            <div class="form-group">
                                <select name="city" class="w-100">
                                    <option value="">City</option>
                                    <option value="1">New York</option>
                                    <option value="2">Los Angeles</option>
                                    <option value="3">Chicago</option>
                                    <option value="4">Houston</option>
                                    <option value="5">Philadelphia</option>
                                </select>
                            </div><!-- /.form-group -->
                            <div class="form-group">
                                <select name="district" class="w-100">
                                    <option value="">District</option>
                                    <option value="1">Manhattan</option>
                                    <option value="2">The Bronx</option>
                                    <option value="3">Brooklyn</option>
                                    <option value="4">Queens</option>
                                    <option value="5">Staten Island</option>
                                </select>
                            </div><!-- /.form-group -->
                            <div class="form-group">
                                <select name="property-type" class="w-100">
                                    <option value="">Property Type</option>
                                    <option value="1">Apartment</option>
                                    <option value="2">Condominium</option>
                                    <option value="3">Cottage</option>
                                    <option value="4">Flat</option>
                                    <option value="5">House</option>
                                </select>
                            </div><!-- /.form-group -->
                            <!-- <div class="form-group">
                                <div class="price-range">
                                </div>
                            </div> -->
                            <div class="form-group">
                                <button type="submit" class="btn btn-default">Search Now</button>
                            </div><!-- /.form-group -->
                        </form><!-- /#form-map -->
                    </aside><!-- /#edit-search -->
                    <aside id="featured-properties">
                        <header><h3>Featured Properties</h3></header>
                        <div class="property small">
                            <a href="property-detail.html">
                                <div class="property-image">
                                    <img alt="" src="assets/img/properties/property-06.jpg">
                                </div>
                            </a>
                            <div class="info">
                                <a href="property-detail.html"><h4>2186 Rinehart Road</h4></a>
                                <figure>Doral, FL 33178 </figure>
                                <div class="tag price">$ 72,000</div>
                            </div>
                        </div><!-- /.property -->
                        <div class="property small">
                            <a href="property-detail.html">
                                <div class="property-image">
                                    <img alt="" src="assets/img/properties/property-09.jpg">
                                </div>
                            </a>
                            <div class="info">
                                <a href="property-detail.html"><h4>2479 Murphy Court</h4></a>
                                <figure>Minneapolis, MN 55402</figure>
                                <div class="tag price">$ 36,000</div>
                            </div>
                        </div><!-- /.property -->
                        <div class="property small">
                            <a href="property-detail.html">
                                <div class="property-image">
                                    <img alt="" src="assets/img/properties/property-03.jpg">
                                </div>
                            </a>
                            <div class="info">
                                <a href="property-detail.html"><h4>1949 Tennessee Avenue</h4></a>
                                <figure>Minneapolis, MN 55402</figure>
                                <div class="tag price">$ 128,600</div>
                            </div>
                        </div><!-- /.property -->
                    </aside><!-- /#featured-properties -->
                    
                </section><!-- /#sidebar -->
            </div><!-- /.col-md-3 -->
            <!-- end Sidebar -->
        </div><!-- /.row -->
    </div><!-- /.container -->
</div>
<!-- end Page Content -->
<app-big-footer></app-big-footer>